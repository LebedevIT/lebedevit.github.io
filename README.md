# Это тестовое задание для TEOXOFT

### Попробовать готовое решение можно по ссылке: https://lebedevit.github.io/
### Репозиторий с исходным кодом: https://github.com/LebedevIT/teoxoft-test

---

Опираясь на требование использовать MVC (Model, View, Controller) рассказываю подробнее как и что работает.

---

__View__:

> 1. Основной файл: ___App.vue___
> 2. Дополнительный файл: ___useModal.vue___

1. Это основной файл верстки. Он состоит из кнопки добавить\сохранить и списка сотрудников. У каждого сотрудника есть своя секция. Внутри каждой секции сотрудника находится: имя, фамилия, стаж, возраст, адрес и кнопка редактирования записи. Так как, в техническом задании сказано, что создание и редактирование новых или уже существующих сотрудников должно производиться в отдельном окне, было принято решение сделать эту функцию в отдельном модальном окне. При нажатии на кнопку «добавить нового сотрудника» вызывается метод, которому мы передаём аргумент false.  Модальное окно является гибким модулем. В случае, если в функцию для его открытия мы передаем аргумент false - модальное окно примет состояние создания нового сотрудника. Метод open, можно посмотреть ниже в секции ___Model___.  Если нажать на кнопку редактирования сотрудника, то откроется тот же метод open, но аргументы уже будут другие. В данном случае, если мы хотим открыть модальное окно в в состоянии редактирования существующего сотрудника, то мы должны передать следующие аргументы : true, объект с данными сотрудника, индекс.

2. Это 2 модуль. Он состоит из заголовка, формы с полями, кнопки сохранить или добавить. В случае если модальное окно открыто в состоянии создания нового сотрудника, поля формы будут пустыми, а на кнопке будет написано «добавить». Если мы открыли модальное окно в состоянии редактирования существующего сотрудника, тогда поменяется заголовок модального окна, поменяется текст и событие при клике на кнопку, поля формы заполнятся данными сотрудника для редактирования. Если мы хотим добавить нового сотрудника, то мы заполняем поля и нажимаем на кнопку добавить. После нажатия на кнопку будет запущена функция контроллера (add_click_handler), которая проверит заполнены ли все поля. В случае успеха соберет объект из новых данных сотрудника и передаст его в модель, а затем закроет модальное окно. Если мы хотим редактировать данные уже существующего сотрудника, тогда мы можем просто поменять нужные нам данные внутри полей, после чего нажать на кнопку сохранить. После нажатия на кнопку сохранить, будет запущена функция контроллера (save_click_handler), которая поверит заполнены все поля. В случае успеха передаст объект с новыми данными сотрудника в модель и закроет модальное окно.


---

__Model__:

Для того чтобы после обновления страницы сохранить уже введенных новых сотрудников, для хранения данных используется LocalStorage браузера. Также, внутри хранилища Pinia находятся тестовые сотрудники для редактирования. Их массив можно посмотреть ниже.
В случае, если модель находит изменения в массиве сотрудников, она сразу же записывает эти изменения в LocalStorage, а после перезагрузки наоборот, достаёт из LocalStorage и записывает в массив. Таким образом, даже после того, как вы добавить новых сотрудников, они не пропадут после перезагрузки страницы!

Отслеживание изменений в массиве:

```
watch(() => employeesStore, (state) => {
    localStorage.setItem('employees', JSON.stringify(state.value)) // Если найдены изменения, переписать массив
  }, {
    deep: true  // Режим глубокого просмотра, для обработки вложенных данных
  })
```

Массив сотрудников:

```
const employeesStore = ref([{
      name: 'Павел',
      surname: 'Васнецов',
      seniority: 2,
      age: 22,
      address: 'Великая улица, 15'
    },
    {
      name: 'Виктор',
      surname: 'Петров',
      seniority: 5,
      age: 30,
      address: 'Московская улица, 1Б'
    },
    {
      name: 'Дмитрий',
      surname: 'Сидоров',
      seniority: 8,
      age: 32,
      address: 'Пушкинская улица, 18'
    },
    {
      name: 'Василий',
      surname: 'Соколов',
      seniority: 6,
      age: 36,
      address: 'Цветочная улица, 15'
    },
  ])
```

Функция добавления нового сотрудника:

```
const add_new_employee = (object) => { // Принимаем в аргументе переданный из контроллера объект
    employeesStore.value.push({  // Добавляем его к массиву сотрудников
      ...object
    })
  }
```

Функция редактирования сотрудника:

```
  const edit_employee = (object, index) => { // Принимаем в аргументе переданный из контроллера объект и индекс
    employeesStore.value[index] = object  // Находим нужного сотрудника по индексу и заменяем его объект
  }
```

Функция открытия модального окна:

```
// Принимает аргументами editPage(boolean), emplpoyee(Object), index(Number)

function open(editPage, employee, index) {
        isModalOpened.value = true  // Открываем модальное окно
        if (editPage && employee) {  // Если передаём сотрудника и true, то включаем состояние редактирования
            isEdit.value = true
            name.value = employee.name  // Заполняем поля
            surname.value = employee.surname
            seniority.value = String(employee.seniority)
            age.value = String(employee.age)
            address.value = employee.address
            id.value = index
        }else {
            isEdit.value = false  // Иначе, включаем состояние добавления сотрудника
        }
    }
```

---

__Controller__:

Функция проверки заполнения полей:

```
// Принимает аргументами editPage(boolean), emplpoyee(Object), index(Number)

function check_inputs() { 
        if (name.value != '' &&
            surname.value != '' &&
            seniority.value != '' &&
            age.value != '' &&
            address.value != '') {
                return true  // Если все поля заполнены, возвращаем успех
        }else {
            return alert('Вы заполнили не все поля.')  // Иначе возвращаем оповещение об ошибке
        }
    }
```

Функция контроля клика на кнопку "Добавить":

```
function add_click_handler() {
        if (check_inputs()) {  // Запускаем контроллер на проверку полей
            const new_employee = {   // Если всё хорошо, собираем объект
                name: name.value,
                surname: surname.value,
                seniority: seniority.value,
                age: age.value,
                address: address.value
            }
            employees.add_new_employee(new_employee)  // Отправляем объект в модель
            isModalOpened.value = false  // Закрываем модальное окно
        }
    }
```

Функция контроля клика на кнопку "Сохранить":

```
function save_click_handler() {
        if (check_inputs()) { // Запускаем контроллер на проверку полей
            const edit_employee = { // Если всё хорошо, собираем объект
                name: name.value,
                surname: surname.value,
                seniority: seniority.value,
                age: age.value,
                address: address.value
            }
            employees.edit_employee(edit_employee, id.value) // Отправляем объект в модель
            isModalOpened.value = false  // Закрываем модальное окно
        }
    }
```

